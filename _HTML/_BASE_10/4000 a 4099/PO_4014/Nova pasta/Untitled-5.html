# MongoDB\Database::createCollection()

## Definition

<div id="mongodb-phpmethod-phpmethod.MongoDB-Database--createCollection--"></div>

`MongoDB\Database::createCollection()`
Explicitly creates a collection.

```php
function createCollection(
    string $collectionName,
    array $options = []
): void
```

MongoDB creates collections implicitly when you first reference the collection in a command, such as when inserting a document into a new collection. You may also explicitly create a collection with specific options using the [`MongoDB\Database::createCollection()`](https://mongodb.com/docs/php-library/current/reference/method/MongoDBDatabase-createCollection/#mongodb-phpmethod-phpmethod.MongoDB-Database--createCollection--) method, or using [db.createCollection()](https://www.mongodb.com/docs/manual/reference/method/db.createCollection/) in the MongoDB shell.

Explicitly creating collections enables you to create [capped collections](https://www.mongodb.com/docs/manual/core/capped-collections/), specify [document validation criteria](https://www.mongodb.com/docs/manual/core/document-validation/), or configure your storage engine or indexing options.

## Parameters

The name of the collection to create.

An array specifying the desired options.

Not all options are available on all versions of MongoDB. Refer to the [create](https://www.mongodb.com/docs/manual/reference/command/create/) command reference in the MongoDB manual for compatibility considerations.

<table>
<tr>
<th id="Name">
Name

</th>
<th id="Type">
Type

</th>
<th id="Description">
Description

</th>
</tr>
<tr>
<td headers="Name">
capped

</td>
<td headers="Type">
boolean

</td>
<td headers="Description">
To create a capped collection, specify `true`. If you specify `true`, you must also set a maximum size in the `size` option.

</td>
</tr>
<tr>
<td headers="Name">
changeStreamPreAndPostImages

</td>
<td headers="Type">
document

</td>
<td headers="Description">
Used to configure support for pre- and post-images in change streams. See the [create](https://www.mongodb.com/docs/manual/reference/command/create/) command documentation for more information.

This option is available since MongoDB 6.0 and will result in an exception at execution time if specified for an older server version.

</td>
</tr>
<tr>
<td headers="Name">
clusteredIndex

</td>
<td headers="Type">
document

</td>
<td headers="Description">
A clustered index specification. See [Clustered Collections](https://www.mongodb.com/docs/manual/core/clustered-collections/) or the [create](https://www.mongodb.com/docs/manual/reference/command/create/) command documentation for more information.

This option is available since MongoDB 5.3 and will result in an exception at execution time if specified for an older server version.

</td>
</tr>
<tr>
<td headers="Name">
collation

</td>
<td headers="Type">
array|object

</td>
<td headers="Description">
[Collation](https://www.mongodb.com/docs/manual/reference/collation/) allows users to specify language-specific rules for string comparison, such as rules for lettercase and accent marks. When specifying collation, the `locale` field is mandatory; all other collation fields are optional. For descriptions of the fields, see [Collation Document](https://www.mongodb.com/docs/manual/reference/collation/#collation-document).

</td>
</tr>
<tr>
<td headers="Name">
comment

</td>
<td headers="Type">
mixed

</td>
<td headers="Description">
Enables users to specify an arbitrary comment to help trace the operation through the [database profiler](https://www.mongodb.com/docs/manual/reference/database-profiler/), [currentOp](https://www.mongodb.com/docs/manual/reference/command/currentOp/) output, and [logs](https://www.mongodb.com/docs/manual/reference/log-messages/).

This option is available since MongoDB 4.4 and will result in an exception at execution time if specified for an older server version.

</td>
</tr>
<tr>
<td headers="Name">
encryptedFields

</td>
<td headers="Type">
document

</td>
<td headers="Description">
A document describing encrypted fields for queryable encryption. If omitted, the `encryptedFieldsMap` option within the `autoEncryption` driver option will be consulted. See [Field Encryption and Queryability](https://www.mongodb.com/docs/manual/core/queryable-encryption/fundamentals/encrypt-and-query/) in the MongoDB manual for more information.

This option is available since MongoDB 7.0 and will result in an exception at execution time if specified for an older server version.

</td>
</tr>
<tr>
<td headers="Name">
expireAfterSeconds

</td>
<td headers="Type">
integer

</td>
<td headers="Description">
Used to automatically delete documents in time series collections. See the [create](https://www.mongodb.com/docs/manual/reference/command/create/) command documentation for more information.

This option is available since MongoDB 5.0 and will result in an exception at execution time if specified for an older server version.

</td>
</tr>
<tr>
<td headers="Name">
indexOptionDefaults

</td>
<td headers="Type">
array|object

</td>
<td headers="Description">
Allows users to specify a default configuration for indexes when creating a collection.

The `indexOptionDefaults` option accepts a `storageEngine` document, which should take the following form:

```none
{ <storage-engine-name>: <options> }
```

Storage engine configurations specified when creating indexes are validated and logged to the [oplog](https://www.mongodb.com/docs/manual/reference/glossary/#std-term-oplog) during replication to support replica sets with members that use different storage engines.

</td>
</tr>
<tr>
<td headers="Name">
max

</td>
<td headers="Type">
integer

</td>
<td headers="Description">
The maximum number of documents allowed in the capped collection. The `size` option takes precedence over this limit. If a capped collection reaches the `size` limit before it reaches the maximum number of documents, MongoDB removes old documents. If you prefer to use the `max` limit, ensure that the `size` limit, which is required for a capped collection, is sufficient to contain the maximum number of documents.

</td>
</tr>
<tr>
<td headers="Name">
maxTimeMS

</td>
<td headers="Type">
integer

</td>
<td headers="Description">
The cumulative time limit in milliseconds for processing operations on the cursor. MongoDB aborts the operation at the earliest following [interrupt point](https://www.mongodb.com/docs/manual/reference/glossary/#std-term-interrupt-point).

</td>
</tr>
<tr>
<td headers="Name">
pipeline

</td>
<td headers="Type">
array

</td>
<td headers="Description">
An array that consists of the aggregation pipeline stage(s), which will be applied to the collection or view specified by `viewOn`. See the [create](https://www.mongodb.com/docs/manual/reference/command/create/) command documentation for more information.

</td>
</tr>
<tr>
<td headers="Name">
session

</td>
<td headers="Type">
[MongoDB\Driver\Session](https://php.net/class.mongodb-driver-session)

</td>
<td headers="Description">
Client session to associate with the operation.

</td>
</tr>
<tr>
<td headers="Name">
size

</td>
<td headers="Type">
integer

</td>
<td headers="Description">
Specify a maximum size in bytes for a capped collection. Once a capped collection reaches its maximum size, MongoDB removes the older documents to make space for the new documents. The `size` option is required for capped collections and ignored for other collections.

</td>
</tr>
<tr>
<td headers="Name">
storageEngine

</td>
<td headers="Type">
array|object

</td>
<td headers="Description">
Available for the WiredTiger storage engine only.

Allows users to specify configuration to the storage engine on a per-collection basis when creating a collection. The value of the `storageEngine` option should take the following form:

```none
{ <storage-engine-name>: <options> }
```

Storage engine configurations specified when creating collections are validated and logged to the [oplog](https://www.mongodb.com/docs/manual/reference/glossary/#std-term-oplog) during replication to support replica sets with members that use different storage engines.

</td>
</tr>
<tr>
<td headers="Name">
timeseries

</td>
<td headers="Type">
array|object

</td>
<td headers="Description">
An object containing options for creating time series collections. See the [create](https://www.mongodb.com/docs/manual/reference/command/create/) command documentation for supported options.

This option is available since MongoDB 5.0 and will result in an exception at execution time if specified for an older server version.

</td>
</tr>
<tr>
<td headers="Name">
typeMap

</td>
<td headers="Type">
array

</td>
<td headers="Description">
The [type map](https://php.net/manual/en/mongodb.persistence.deserialization.php#mongodb.persistence.typemaps) to apply to cursors, which determines how BSON documents are converted to PHP values. Defaults to the database's type map.

This will be used for the returned command result document.

</td>
</tr>
<tr>
<td headers="Name">
validationAction

</td>
<td headers="Type">
string

</td>
<td headers="Description">
Determines whether to `error` on invalid documents or just `warn` about the violations but allow invalid documents to be inserted.

IMPORTANT: Validation of documents only applies to those documents as determined by the `validationLevel`.

<table>
<tr>
<th id="validationAction">
`validationAction`

</th>
<th id="Description">
Description

</th>
</tr>
<tr>
<td headers="validationAction">
`"error"`

</td>
<td headers="Description">
**Default**. Documents must pass validation before the write occurs. Otherwise, the write operation fails.

</td>
</tr>
<tr>
<td headers="validationAction">
`"warn"`

</td>
<td headers="Description">
Documents do not have to pass validation. If the document fails validation, the write operation logs the validation failure.

</td>
</tr>
</table>

</td>
</tr>
<tr>
<td headers="Name">
validationLevel

</td>
<td headers="Type">
string

</td>
<td headers="Description">
Determines how strictly MongoDB applies the validation rules to existing documents during an update.

<table>
<tr>
<th id="validationLevel">
`validationLevel`

</th>
<th id="Description">
Description

</th>
</tr>
<tr>
<td headers="validationLevel">
`"off"`

</td>
<td headers="Description">
No validation for inserts or updates.

</td>
</tr>
<tr>
<td headers="validationLevel">
`"strict"`

</td>
<td headers="Description">
**Default**. Apply validation rules to all inserts and all updates.

</td>
</tr>
<tr>
<td headers="validationLevel">
`"moderate"`

</td>
<td headers="Description">
Apply validation rules to inserts and to updates on existing *valid* documents. Do not apply rules to updates on existing *invalid* documents.

</td>
</tr>
</table>

</td>
</tr>
<tr>
<td headers="Name">
validator

</td>
<td headers="Type">
array|object

</td>
<td headers="Description">
Allows users to specify [validation rules or expressions](https://www.mongodb.com/docs/manual/core/document-validation/) for the collection. For more information, see [Document Validation](https://www.mongodb.com/docs/manual/core/document-validation/) in the MongoDB manual.

The `validator` option takes an array that specifies the validation rules or expressions. You can specify the expressions using the same operators as MongoDB's [query operators](https://www.mongodb.com/docs/manual/reference/operator/query/) with the exception of [`$near`](https://www.mongodb.com/docs/manual/reference/operator/query/near/#mongodb-query-op.-near), [`$nearSphere`](https://www.mongodb.com/docs/manual/reference/operator/query/nearSphere/#mongodb-query-op.-nearSphere), [`$text`](https://www.mongodb.com/docs/manual/reference/operator/query/text/#mongodb-query-op.-text), and [`$where`](https://www.mongodb.com/docs/manual/reference/operator/query/where/#mongodb-query-op.-where).

Validation occurs during updates and inserts. Existing documents do not undergo validation checks until modification.

You cannot specify a validator for collections in the `admin`, `local`, and `config` databases.

You cannot specify a validator for `system.*` collections.

</td>
</tr>
<tr>
<td headers="Name">
viewOn

</td>
<td headers="Type">
string

</td>
<td headers="Description">
The name of the source collection or view from which to create the view.

The name is not the full namespace of the collection or view (i.e. it does not include the database name). Views must be created in the same databases as the source collection or view.

</td>
</tr>
<tr>
<td headers="Name">
writeConcern

</td>
<td headers="Type">
[MongoDB\Driver\WriteConcern](https://php.net/class.mongodb-driver-writeconcern)

</td>
<td headers="Description">
[Write concern](https://www.mongodb.com/docs/manual/reference/write-concern/) to use for the operation. Defaults to the database's write concern.

</td>
</tr>
</table>

## Errors/Exceptions

[`MongoDB\Exception\UnsupportedException`](https://mongodb.com/docs/php-library/current/reference/exception-classes/#mongodb-phpclass-phpclass.MongoDB-Exception-UnsupportedException) if options are used and not supported by the selected server (e.g. `collation`, `readConcern`, `writeConcern`).

[`MongoDB\Exception\InvalidArgumentException`](https://mongodb.com/docs/php-library/current/reference/exception-classes/#mongodb-phpclass-phpclass.MongoDB-Exception-InvalidArgumentException) for errors related to the parsing of parameters or options.

[MongoDB\Driver\Exception\RuntimeException](https://php.net/mongodb-driver-exception-runtimeexception) for other errors at the extension level (e.g. connection errors).

## Example

The following example creates a `users` collection in the `test` database with document validation criteria:

```php
<?php

$db = (new MongoDB\Client)->test;

$db->createCollection('users', [
    'validator' => [
        'username' => ['$type' => 'string'],
        'email' => ['$regex' => '@mongodb\.com$'],
    ],
]);
```

## See Also

- [create](https://www.mongodb.com/docs/manual/reference/command/create/) command reference in the MongoDB manual

- [db.createCollection()](https://www.mongodb.com/docs/manual/reference/method/db.createCollection/)

- [Time Series Collections](https://www.mongodb.com/docs/manual/core/timeseries-collections/)